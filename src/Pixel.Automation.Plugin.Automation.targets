<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

	<Target Name="BuildPlugins" AfterTargets="Build">
		<ItemGroup Condition="'$(TargetFramework)' == 'net6.0' Or '$(TargetFramework)' == 'net6.0-windows'">
			<PluginProject Include="..\Pixel.Automation.Assertions.Components\Pixel.Automation.Assertions.Components.csproj"/>
			<PluginProject Include="..\Pixel.Automation.Image.Matching.Components\Pixel.Automation.Image.Matching.Components.csproj"/>
			<PluginProject Include="..\Pixel.Automation.Input.Devices.Components\Pixel.Automation.Input.Devices.Components.csproj"/>
			<PluginProject Include="..\Pixel.Automation.Scripting.Components\Pixel.Automation.Scripting.Components.csproj"/>
			<PluginProject Include="..\Pixel.Automation.Web.Playwright.Components\Pixel.Automation.Web.Playwright.Components.csproj"/>
			<PluginProject Include="..\Pixel.Automation.Web.Selenium.Components\Pixel.Automation.Web.Selenium.Components.csproj"/>
			<PluginProject Include="..\Pixel.Automation.Window.Management.Components\Pixel.Automation.Window.Management.Components.csproj"/>
		</ItemGroup>
		<ItemGroup Condition="'$(TargetFramework)' == 'net6.0-windows'">
			<PluginProject Include="..\Pixel.Automation.Java.Access.Bridge.Components\Pixel.Automation.Java.Access.Bridge.Components.csproj"/>
			<PluginProject Include="..\Pixel.Automation.Native.Windows\Pixel.Automation.Native.Windows.csproj"/>
			<PluginProject Include="..\Pixel.Automation.UIA.Components\Pixel.Automation.UIA.Components.csproj"/>			
		</ItemGroup>
		<Message Text="TargetFramework is $(TargetFramework)" Importance="high"/>
		<MSBuild Projects="@(PluginProject)" Targets="Build" Properties="Configuration=$(Configuration);
				 RuntimeIdentifier=$(RuntimeIdentifier);"/>
	</Target>


	<Target Name="CopyPlugins" AfterTargets="BuildPlugins">
		<ItemGroup Condition="'$(TargetFramework)' == 'net6.0' Or '$(TargetFramework)' == 'net6.0-windows'">
			<PluginArtifacts Include="..\Pixel.Automation.Assertions.Components\bin\$(Configuration)\$(TargetFramework)\$(RuntimeIdentifier)\**\*.*">
				<Name>Pixel.Automation.Assertions.Components</Name>
			</PluginArtifacts>
			<PluginArtifacts Include="..\Pixel.Automation.Image.Matching.Components\bin\$(Configuration)\$(TargetFramework)\$(RuntimeIdentifier)\**\*.*">
				<Name>Pixel.Automation.Image.Matching.Components</Name>
			</PluginArtifacts>
			<PluginArtifacts Include="..\Pixel.Automation.Input.Devices.Components\bin\$(Configuration)\$(TargetFramework)\$(RuntimeIdentifier)\**\*.*">
				<Name>Pixel.Automation.Input.Devices.Components</Name>
			</PluginArtifacts>
			<PluginArtifacts Include="..\Pixel.Automation.Scripting.Components\bin\$(Configuration)\$(TargetFramework)\$(RuntimeIdentifier)\**\*.*">
				<Name>Pixel.Automation.Scripting.Components</Name>
			</PluginArtifacts>
			<PluginArtifacts Include="..\Pixel.Automation.Web.Playwright.Components\bin\$(Configuration)\$(TargetFramework)\$(RuntimeIdentifier)\**\*.*">
				<Name>Pixel.Automation.Web.Playwright.Components</Name>
			</PluginArtifacts>
			<PluginArtifacts Include="..\Pixel.Automation.Web.Selenium.Components\bin\$(Configuration)\$(TargetFramework)\$(RuntimeIdentifier)\**\*.*">
				<Name>Pixel.Automation.Web.Selenium.Components</Name>
			</PluginArtifacts>
			<PluginArtifacts Include="..\Pixel.Automation.Window.Management.Components\bin\$(Configuration)\$(TargetFramework)\$(RuntimeIdentifier)\**\*.*">
				<Name>Pixel.Automation.Window.Management.Components</Name>
			</PluginArtifacts>
		</ItemGroup>
		<ItemGroup Condition="'$(TargetFramework)' == 'net6.0-windows'">
			<PluginArtifacts Include="..\Pixel.Automation.Native.Windows\bin\$(Configuration)\$(TargetFramework)\$(RuntimeIdentifier)\**\*.*">
				<Name>Pixel.Automation.Native.Windows</Name>
			</PluginArtifacts>
			<PluginArtifacts Include="..\Pixel.Automation.Java.Access.Bridge.Components\bin\$(Configuration)\$(TargetFramework)\$(RuntimeIdentifier)\**\*.*">
				<Name>Pixel.Automation.Java.Access.Bridge.Components</Name>
			</PluginArtifacts>
			<PluginArtifacts Include="..\Pixel.Automation.UIA.Components\bin\$(Configuration)\$(TargetFramework)\$(RuntimeIdentifier)\**\*.*">
				<Name>Pixel.Automation.UIA.Components</Name>
			</PluginArtifacts>			
		</ItemGroup>
		<Message Text="Copying %(PluginArtifacts.FullPath) to $(TargetDir)Plugin\%(PluginArtifacts.Name)" Importance="high"/>
		<Copy SourceFiles="%(PluginArtifacts.FullPath)" DestinationFolder="$(TargetDir)Plugins\%(PluginArtifacts.Name)\%(RecursiveDir)"/>
	</Target>

	<Target Name="MoveOpenCVRuntimes" AfterTargets="CopyPlugins">
		<ItemGroup>
			<PluginRuntimeFiles Include="$(TargetDir)\Plugins\Pixel.Automation.Image.Matching.Components\runtimes\**\*.*"/>
		</ItemGroup>
		<Move  SourceFiles="@(PluginRuntimeFiles)"  DestinationFolder="$(TargetDir)\runtimes\%(RecursiveDir)" ContinueOnError="true"/>
	</Target>

	<!--Move .playwright folder and playwright.ps1 file to app directory and delete these from Pixel.Automation.Web.Playwright.Components
		and Pixel.Automation.Web.Scrapper plugins-->
	<Target Name="ManagePlaywrightDependencies" AfterTargets="CopyPlugins">
		<ItemGroup>
			<PlaywrightFiles Include="$(TargetDir)\Plugins\Pixel.Automation.Web.Playwright.Components\.playwright\**\*.*;"/>
		</ItemGroup>
		<Move  SourceFiles="@(PlaywrightFiles)" DestinationFolder="$(TargetDir)\.playwright\%(RecursiveDir)"/>
		<Move  SourceFiles="$(TargetDir)\Plugins\Pixel.Automation.Web.Playwright.Components\playwright.ps1"
			   DestinationFolder="$(TargetDir)"/>
		<RemoveDir Directories="$(TargetDir)\Plugins\Pixel.Automation.Web.Playwright.Components\.playwright"/>
		<RemoveDir Directories="$(TargetDir)\Plugins\Pixel.Automation.Web.Scrapper\.playwright"/>
		<Delete Files="$(TargetDir)\Plugins\Pixel.Automation.Web.Scrapper\playwright.ps1" />
	</Target>

</Project>