<MudTable UserAttributes="@(new (){{"id","tblTriggers"}})" Items="@(Triggers ?? Enumerable.Empty<SessionTrigger>())" Dense="false" Hover="true" ReadOnly="false"
          CanCancelEdit="true" Filter="@(new Func<SessionTrigger,bool>(FilterFunc))" @ref="table"
          @bind-SelectedItem="selectedTrigger" SortLabel="Sort By" CommitEditTooltip="Commit Edit"
          OnCommitEditClick="UpdateItemAsync"
          RowEditPreview="BackupItem" RowEditCancel="ResetItemToOriginalValues"
          IsEditRowSwitchingBlocked="true" Elevation="4">
    <ToolBarContent>
        <MudText Typo="Typo.h6">Triggers</MudText>
        <MudIconButton UserAttributes="@(new (){{"id","btnNewTrigger"}})" Icon="@Icons.Material.Outlined.AddCircleOutline" Size="Size.Medium"
                       @onclick="@(() => OnAddItem.InvokeAsync())" Color="Color.Primary"></MudIconButton>
        <MudSpacer />
        <MudTextField UserAttributes="@(new (){{"id","txtSearchBox"}})" @bind-Value="searchString" Placeholder="Search" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0"></MudTextField>
    </ToolBarContent>
    <ColGroup>
        <col style="width:16%;" />
        <col style="width:32%;" />     
        <col style="width:32%;" />
        <col style="width:10%;" />
        <col style="width:10%;" />
    </ColGroup>
    <HeaderContent>
        <MudTh>Is Enabled</MudTh>      
        <MudTh><MudTableSortLabel SortBy="new Func<SessionTrigger, object>(x=>x.Handler)">Handler</MudTableSortLabel></MudTh>
        <MudTh>Cron Expression</MudTh>  
        <MudTh></MudTh>
        <MudTh></MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd UserAttributes="@(new (){{"id","tdEnabled"}})" DataLabel="">@context.IsEnabled</MudTd>       
        <MudTd UserAttributes="@(new (){{"id","tdHandler"}})" DataLabel="Include in access token">@context.Handler</MudTd>
        @if(context is CronSessionTrigger cronSessionTrigger)
        {
            <MudTd UserAttributes="@(new (){{"id","tdCronExpression"}})" DataLabel="Include in identity token">@cronSessionTrigger.CronExpression</MudTd>
        }
        <MudTd DataLabel="">
            <MudIconButton UserAttributes="@(new (){{"id","btnEdit"}})" Icon="@Icons.Material.Filled.Edit" Color="Color.Primary"
                           @onclick="() => EditItem(context)" Size="Size.Medium"></MudIconButton>
        </MudTd>
        <MudTd DataLabel="">
            <MudIconButton UserAttributes="@(new (){{"id","btnDelete"}})" Icon="@Icons.Material.Filled.Delete" Color="Color.Error"
                           @onclick="() => OnDeleteItem.InvokeAsync(context)" Size="Size.Medium"></MudIconButton>
        </MudTd>
    </RowTemplate>
    <RowEditingTemplate>
         <MudTd DataLabel="IsEnabled">
           <MudSwitch UserAttributes="@(new (){{"id","cbIsEnabled"}})" @bind-Checked="@context.IsEnabled" Color="Color.Primary" />
        </MudTd>       
        <MudTd DataLabel="Handler">
            <MudTextField UserAttributes="@(new (){{"id","txtHandler"}})" @bind-Value="@context.Handler" Required />
        </MudTd>
        @if (context is CronSessionTrigger cronSessionTrigger)
        {
            <MudTd DataLabel="Cron Expression">
                <MudTextField UserAttributes="@(new (){{"id","txtCronExpression"}})" @bind-Value="@cronSessionTrigger.CronExpression" Required />
            </MudTd>
        }       
        <MudTd DataLabel="">
        </MudTd>
        <MudTd DataLabel="">
        </MudTd>
    </RowEditingTemplate>
    <PagerContent>
        <MudTablePager />
    </PagerContent>
</MudTable>
